@page "/speed"
@layout OtherLayout

<div class="content-panel">
    <div class="content-panel__toolbar">
        <MudToolBar Gutters="false" Dense="true">
            @if (!DrawerOpen)
            {
                <MudIconButton Icon="@Icons.Material.Outlined.NavigateBefore" OnClick="NavigateBack" title="Back to torrent list" />
                <MudDivider Vertical="true" />
            }
            <MudDivider Vertical="true" />
            <MudText Class="pl-5 no-wrap">Speed</MudText>
        </MudToolBar>
    </div>

    <div class="content-panel__body">
        <MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="content-panel__container pt-4">
            <MudPaper Class="pa-4 mb-4">
                <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Wrap="Wrap.Wrap">
                    <MudToggleGroup T="SpeedPeriod"
                                    Color="Color.Primary"
                                    Outlined="true"
                                    Delimiters="true"
                                    SelectionMode="SelectionMode.SingleSelection"
                                    Size="Size.Small"
                                    Value="_selectedPeriod"
                                    ValueChanged="OnPeriodChanged"
                                    data-test-id="@TestIdHelper.For("PeriodToggleGroup")">
                        @foreach (var option in PeriodOptions)
                        {
                            <MudToggleItem Value="option.Period" data-test-id="@TestIdHelper.For($"PeriodToggle-{option.Period}")">@option.Label</MudToggleItem>
                        }
                    </MudToggleGroup>
                    <MudSpacer />
                    <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
                        <MudSwitch T="bool" Value="@_includeDownload" ValueChanged="ToggleDownload" Color="Color.Success" Label="Download" data-test-id="@TestIdHelper.For("DownloadToggle")" />
                        <MudSwitch T="bool" Value="@_includeUpload" ValueChanged="ToggleUpload" Color="Color.Info" Label="Upload" data-test-id="@TestIdHelper.For("UploadToggle")" />
                    </MudStack>
                </MudStack>
            </MudPaper>

            @if (_series.Count == 0)
            {
                <MudAlert Severity="Severity.Info" Variant="Variant.Outlined">
                    No speed data yet. Keep this tab open to accumulate history.
                </MudAlert>
            }
            else
            {
                <MudPaper Class="pa-4 speed-chart-container">
                    <MudTimeSeriesChart ChartSeries="@_series"
                                        ChartOptions="@_chartOptions"
                                        AxisChartOptions="@_axisOptions"
                                        TimeLabelSpacing="@_timeLabelSpacing"
                                        Height="360px"
                                        Width="100%"
                                        TimeLabelFormat="''"
                                        DataMarkerTooltipTimeLabelFormat="HH:mm:ss"
                                        Class="speed-chart"
                                        data-test-id="@TestIdHelper.For("SpeedChart")" />
                    <MudText Typo="Typo.caption" Class="mt-2">
                        Last updated: @_lastUpdatedText
                    </MudText>
                </MudPaper>
            }
        </MudContainer>
    </div>
</div>
